<!DOCTYPE html>
<html>
<head>
    <title>Ataque de Asteroides (Táctil)</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: monospace;
            color: #fff;
            user-select: none;
            touch-action: none; /* Desactiva el zoom y scroll en el canvas */
        }

        h1 {
            color: #ffcc00;
            margin-bottom: 5px;
            font-size: 1.5em;
        }

        #contenedorJuego {
            position: relative;
        }

        canvas {
            border: 3px solid #ffcc00;
            background: #111;
            display: block;
        }

        #hud {
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            padding: 5px;
            color: #00ff00;
            pointer-events: none; /* Asegura que no interfiera con el toque en el canvas */
        }

        #mensajeFinal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            border: 3px solid #ffcc00;
            padding: 20px;
            text-align: center;
            display: none; /* Oculto por defecto */
            z-index: 100;
        }
        
        #mensajeFinal button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }

    </style>
</head>
<body>
    <h1>Ataque de Asteroides 🚀</h1>
    
    <div id="contenedorJuego">
        <canvas id="juegoCanvas" width="360" height="540"></canvas>
        <div id="hud">
            <span>PUNTOS: <span id="scoreDisplay">0</span></span>
            <span>VIDAS: <span id="livesDisplay">3</span></span>
        </div>
        <div id="mensajeFinal">
            <h2>¡GAME OVER!</h2>
            <p>Tu Puntuación Final: <span id="finalScore">0</span></p>
            <button onclick="iniciarJuego()">Volver a Jugar</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById("juegoCanvas");
        const ctx = canvas.getContext("2d");
        const ancho = canvas.width;
        const alto = canvas.height;

        // Elementos HUD/UI
        const scoreDisplay = document.getElementById('scoreDisplay');
        const livesDisplay = document.getElementById('livesDisplay');
        const mensajeFinal = document.getElementById('mensajeFinal');
        const finalScore = document.getElementById('finalScore');

        // -------------------------------------------------------------------
        // VARIABLES GLOBALES
        // -------------------------------------------------------------------
        let juegoActivo = false;
        let score = 0;
        let vidas = 3;
        let asteroides = [];
        let nave = { x: ancho / 2, y: alto - 50, radio: 15, color: '#00BFFF' };
        let dificultad = 1.0;
        let generadorIntervalo;
        let bucleJuegoFrame;

        // -------------------------------------------------------------------
        // LÓGICA DE OBJETOS
        // -------------------------------------------------------------------

        function crearAsteroide() {
            // Asteroides aparecen en la parte superior con un radio y velocidad aleatorios
            const radio = Math.random() * 10 + 15; // Radio entre 15 y 25
            const x = Math.random() * (ancho - radio * 2) + radio;
            const y = -radio; // Empieza justo fuera del canvas

            const velocidadX = (Math.random() - 0.5) * 1.5; // Movimiento horizontal ligero
            const velocidadY = (Math.random() * 1.5 + 1.5) * dificultad; // Velocidad base

            asteroides.push({
                x: x,
                y: y,
                radio: radio,
                velocidadX: velocidadX,
                velocidadY: velocidadY,
                vida: Math.floor(radio / 5), // Asteroides más grandes requieren más toques
                color: `hsl(${Math.random() * 360}, 70%, 50%)`
            });
        }

        function actualizarAsteroides() {
            for (let i = asteroides.length - 1; i >= 0; i--) {
                const asteroide = asteroides[i];
                asteroide.x += asteroide.velocidadX;
                asteroide.y += asteroide.velocidadY;

                // Si el asteroide sale por la parte inferior
                if (asteroide.y > alto + asteroide.radio) {
                    asteroides.splice(i, 1); // Eliminar asteroide
                    perderVida();
                    continue;
                }

                // Comprobar colisión con la nave (simple)
                const distancia = Math.sqrt((asteroide.x - nave.x) ** 2 + (asteroide.y - nave.y) ** 2);
                if (distancia < asteroide.radio + nave.radio) {
                    asteroides.splice(i, 1); // Eliminar asteroide
                    perderVida(); 
                }
            }
        }

        // -------------------------------------------------------------------
        // LÓGICA DE JUEGO
        // -------------------------------------------------------------------

        function actualizarHUD() {
            scoreDisplay.textContent = score;
            livesDisplay.textContent = vidas;
        }

        function perderVida() {
            if (!juegoActivo) return;

            vidas--;
            actualizarHUD();
            
            if (vidas <= 0) {
                terminarJuego();
            }
        }
        
        function terminarJuego() {
            juegoActivo = false;
            clearInterval(generadorIntervalo);
            cancelAnimationFrame(bucleJuegoFrame);

            finalScore.textContent = score;
            mensajeFinal.style.display = 'block';
        }

        // -------------------------------------------------------------------
        // DIBUJO
        // -------------------------------------------------------------------

        function dibujarNave() {
            ctx.fillStyle = nave.color;
            ctx.beginPath();
            // Dibujar un pequeño triángulo como nave
            ctx.moveTo(nave.x, nave.y - nave.radio); // Punta superior
            ctx.lineTo(nave.x - nave.radio, nave.y + nave.radio); // Esquina inferior izquierda
            ctx.lineTo(nave.x + nave.radio, nave.y + nave.radio); // Esquina inferior derecha
            ctx.closePath();
            ctx.fill();
        }

        function dibujarAsteroides() {
            asteroides.forEach(asteroide => {
                // Dibujar el cuerpo del asteroide
                ctx.fillStyle = asteroide.color;
                ctx.beginPath();
                ctx.arc(asteroide.x, asteroide.y, asteroide.radio, 0, Math.PI * 2);
                ctx.fill();

                // Dibujar el contador de vida (opcional, pero ayuda)
                ctx.fillStyle = 'white';
                ctx.font = '12px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(asteroide.vida, asteroide.x, asteroide.y + 4);
            });
        }

        function dibujar() {
            if (!juegoActivo) return;

            ctx.clearRect(0, 0, ancho, alto);

            // Fondo (estrellas)
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, ancho, alto);

            actualizarAsteroides();
            dibujarAsteroides();
            dibujarNave();

            bucleJuegoFrame = requestAnimationFrame(dibujar);
        }

        // -------------------------------------------------------------------
        // ENTRADA TÁCTIL (¡La clave!)
        // -------------------------------------------------------------------

        function manejarToque(e) {
            e.preventDefault();
            if (!juegoActivo) return;

            // Obtener coordenadas de toque relativas al canvas
            const rect = canvas.getBoundingClientRect();
            const xToque = (e.clientX || e.touches[0].clientX) - rect.left;
            const yToque = (e.clientY || e.touches[0].clientY) - rect.top;

            // Comprobar colisión con asteroides
            for (let i = asteroides.length - 1; i >= 0; i--) {
                const asteroide = asteroides[i];

                // Distancia del toque al centro del asteroide
                const distancia = Math.sqrt((xToque - asteroide.x) ** 2 + (yToque - asteroide.y) ** 2);

                if (distancia < asteroide.radio) {
                    // Tocado!
                    asteroide.vida--;
                    score += 10;
                    actualizarHUD();

                    if (asteroide.vida <= 0) {
                        // Asteroide destruido
                        asteroides.splice(i, 1);
                        score += 50; // Bonus por destrucción
                        dificultad += 0.05; // Aumentar ligeramente la dificultad
                    } else {
                        // Cambiar color para feedback visual
                        asteroide.color = '#FF4500'; 
                    }
                    
                    // Solo procesar un toque por ciclo para evitar errores
                    return; 
                }
            }
        }

        canvas.addEventListener('mousedown', manejarToque);
        canvas.addEventListener('touchstart', manejarToque);

        // -------------------------------------------------------------------
        // INICIO Y REINICIO
        // -------------------------------------------------------------------

        function iniciarJuego() {
            // Resetear variables
            score = 0;
            vidas = 3;
            dificultad = 1.0;
            asteroides = [];
            juegoActivo = true;

            // Ocultar mensaje final
            mensajeFinal.style.display = 'none';

            // Resetear HUD
            actualizarHUD();

            // Iniciar generador de asteroides
            clearInterval(generadorIntervalo);
            generadorIntervalo = setInterval(crearAsteroide, 1200 / dificultad); // Más rápido con la dificultad

            // Iniciar bucle de dibujo
            cancelAnimationFrame(bucleJuegoFrame);
            dibujar();
        }

        // Iniciar el juego al cargar la página
        iniciarJuego(); 
    </script>
</body>
</html>